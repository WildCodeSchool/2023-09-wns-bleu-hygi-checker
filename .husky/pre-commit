#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

fileList=$(git diff --staged --name-only :^package.json :^.husky/pre-commit :^frontend :^backend :^e2e-tests :^.github :^.gitignore)

echo ' '
echo '-------------  ğŸ”  START THE PRE COMMIT CHECK PROCESS  ğŸ”   -----------'
echo ' '
echo ' â¡ï¸  Checking staged files.'


if [ ! -z "$fileList" ]
then
  echo "âŒ error: Unauthorized modifications in staged files âŒ"

  echo "$fileList"

  echo "use 'git restore --staged ...' to fix the problem"

  exit 1
fi

echo ' âœ… Staged files checked successfully ! âœ…'
echo ' '
echo ' '
echo ' â¡ï¸  Start linting checks'
echo " [TIPS] if you have Prettier or ESlint issues, use 'npm run prettier-fix-all' or 'npm run eslint-fix-all' in the root folder to lint your code"
echo ' '

npm run lint

echo ' '
echo ' âœ… No error found, your code is well linted. Good job !!! âœ…'
echo ' '

echo ' â¡ï¸  Start unit tests'

# cd ./frontend && npm run test

echo ' '
echo ' âœ… All tests passed, your code works fine !!! âœ…'
echo ' '
echo ' ğŸš€ğŸ”¥ Congrats !! Your code is clean, you can push it on Github ğŸ”¥ğŸš€'
echo ' '
echo '-------------  ğŸ” PRE COMMIT CHECK PROCESS FINISHED ğŸ”   -----------'
echo ' '
